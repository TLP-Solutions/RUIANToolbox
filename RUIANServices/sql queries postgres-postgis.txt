CREATE TABLE test
(

gid serial NOT NULL,

kod_obce character varying(50),

nazev_obce character varying(50),

nazev_momc character varying(50),

nazev_mop character varying(50),

kod_casti_obce character varying(50),

nazev_casti_obce character varying(50),

nazev_ulice character varying(50),

typ_so character varying(50),

cislo_domovni character varying(5),

cislo_orientacni character varying(5),

znak_cisla_orientacniho character varying(10),

psc character varying(10),

latitude numeric(16,6),

longitude numeric(16,6),

plati_od character varying(20),

the_geom geometry,

CONSTRAINT landmarks_pkey PRIMARY KEY (gid),

CONSTRAINT enforce_dims_the_geom CHECK (st_ndims(the_geom) = 2),

CONSTRAINT enforce_geotype_geom CHECK (geometrytype(the_geom) = 'POINT'::text OR the_geom IS NULL),

CONSTRAINT enforce_srid_the_geom CHECK (st_srid(the_geom) = 5514)

);


copy test(gid,kod_obce,nazev_obce,nazev_momc,nazev_mop,kod_casti_obce, nazev_casti_obce, nazev_ulice, typ_so, cislo_domovni, cislo_orientacni, znak_cisla_orientacniho, psc,latitude,longitude, plati_od) FROM 'C:/k_importu.txt' DELIMITERS ';' CSV HEADER;


update test
SET the_geom = ST_GeomFromText('POINT(' || longitude || ' ' || latitude || ')',5514);


COPY ui_mop FROM 'C:/Program Files/PostgreSQL/ui_mop.csv' DELIMITER ';' CSV HEADER;


CREATE TABLE address_points
AS SELECT adresnimista.kod gid, obce.kod kod_obce, obce.nazev nazev_obce, ui_momc.nazev nazev_momc, ui_mop.nazev nazev_mop, castiobci.kod kod_casti_obce, castiobci.nazev nazev_casti_obce, ulice.nazev nazev_ulice, typ_st_objektu.zkratka typ_so, adresnimista.cislodomovni cislo_domovni, adresnimista.cisloorientacni cislo_orientacni, adresnimista.cisloorientacnipismeno znak_cisla_orientacniho, adresnimista.psc psc, -ST_X(adresnibod) latitude, -ST_Y(adresnibod) longitude, adresnimista.platiod plati_od, adresnimista.adresnibod the_geom
FROM adresnimista
LEFT OUTER JOIN ulice on (adresnimista.ulicekod=ulice.kod)
LEFT OUTER JOIN stavebniobjekty on (adresnimista.stavebniobjektkod=stavebniobjekty.kod )
LEFT OUTER JOIN castiobci on (stavebniobjekty.castobcekod=castiobci.kod)
LEFT OUTER JOIN obce on (castiobci.obeckod=obce.kod)
LEFT OUTER JOIN typ_st_objektu on (stavebniobjekty.typstavebnihoobjektukod=typ_st_objektu.kod)
LEFT OUTER JOIN ui_momc on (stavebniobjekty.momckod=ui_momc.kod)
LEFT OUTER JOIN ui_mop on (ui_momc.mop_kod=ui_mop.kod)


ALTER TABLE address_points
ADD PRIMARY KEY (gid)