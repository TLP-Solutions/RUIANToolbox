# -*- coding: cp1250 -*-
#-------------------------------------------------------------------------------
# Name:        DBHandlers
# Purpose:     Definuje abstraktní t?ídu pro ovládání databáze
#              a testovací balí?ek k ní
#
# Author:      Augustyn
#
# Created:     03.05.2013
# Copyright:   (c) Augustyn 2013
# Licence:     <your licence>
#-------------------------------------------------------------------------------
class DatabaseHandler:
    """ Abstraktní definice databáze. """

    def deleteTable(self, tableName):
        ''' Uvol?uje tabulku tableName, vrací True pokud se poda?ilo  '''
        return False

    def tableExists(self, tableName):
        ''' Vrací True, jestliže tabulka tableName v databázi existuje. '''
        return False

    def createTable(self, tableName, overwriteIfExists = False):
        ''' Vytvo?í tabulku tableName, pokud ješt? neexistuje, se sloupci podle definice v
        configRUIAN.tableDef.'''
        return False

    def writeRowToTable(self, tableName, columnValues):
        ''' Zapíše nový ?ádek do databáze s hodnotami uloženými v dictionary columnValues '''
        return False

    def closeTable(self, tableName):
        ''' Uzavírá tabulku tableName '''
        return False


import unittest
import configRUIAN

class TestHandler(unittest.TestCase):
    """ Definice databáze pomocí testunit.
    """
    testTableName = "testTable"

    def setUp(self):
        self.h = None

# k testovani jsem nechal od kazdeho typu jeden
        configRUIAN.tableDef[TestHandler.testTableName] = {
            "skipNamespacePrefix" : "true", # remove namespace prefix obi, oki etc
            "fields":{
                "Kod":                   {"type":"Integer", "notNull" : "yes", "pkey" : "yes"},
                "Nazev":                 {"type":"String"},
##                "StatusKod":             {"type":"Integer"},
                "PlatiOd":               {"type":"DateTime"},
##                "PlatiDo":               {"type":"DateTime"},
                "IdTransakce":           {"type":"Long"},
##                "GlobalniIdNavrhuZmeny": {"type":"Long"},
##                "VlajkaText":            {"type":"String"},
##                "ZnakText":              {"type":"String"},
                "DefinicniBod":          {"type":"MultiPointPropertyType",   "xmlSubPath" : "Geometrie/DefinicniBod"},
                "OriginalniHranice":     {"type":"MultiSurfacePropertyType", "xmlSubPath" : "Geometrie/OriginalniHranice"}
            }
        }

        pass

    def tearDown(self):
        self.h = None
        pass

    def testHandlerAssigned(self):
        self.assertIsNotNone(self.h, "Database handler not assigned")

    def testcreateTable(self):
        self.assertEqual(self.h.createTable(TestHandler.testTableName, True), True, "Vytvo?ení testovací tabulky")
        self.assertEqual(self.h.tableExists(TestHandler.testTableName), True, "Ov??ení jestli vytvo?ená tabulka existuje")
        pass

    def testdeleteTable(self):
        self.h.createTable(TestHandler.testTableName)
        self.assertEqual(self.h.deleteTable(TestHandler.testTableName), True, "Vytvo?íme tabulku a následn? ji smažeme")
        self.assertEqual(self.h.deleteTable("NonExistingTable"), False, "Snaha o smazání neexistující tabulky -> vrací False")
        pass

    def testtableNameToFileName(self):
        pass

    def testtableExists(self):
        if self.h.createTable(TestHandler.testTableName, True):
            self.assertEqual(self.h.tableExists(TestHandler.testTableName), True, "Ov??ení jestli vytvo?ená tabulka existuje")
            self.h.deleteTable(TestHandler.testTableName)
            self.assertEqual(self.h.tableExists(TestHandler.testTableName), False, "Tabulku jsme práv? vymazali, takže neexistuje")
        pass

    def testwriteRowToTable(self):
        self.h.writeRowToTable(TestHandler.testTableName,
          { 'Kod' : '539228',
            'Nazev':'Holubice',
            'PlatiOd':'2011-07-02T00:00:00',
            'IdTransakce':'12042',
            'DefinicniBod': '<gml:MultiPoint gml:id="DOB.539228.X" srsName="urn:ogc:def:crs:EPSG::2065" srsDimension="2"><gml:pointMembers><gml:Point gml:id="DOB.539228.1"><gml:pos>750137.00 1029016.00</gml:pos></gml:Point></gml:pointMembers></gml:MultiPoint>',
            'OriginalniHranice': '<gml:MultiSurface gml:id="HOB.539228" srsName="urn:ogc:def:crs:EPSG::2065" srsDimension="2"><gml:surfaceMember><gml:Polygon gml:id="HOB.539228.1"><gml:exterior><gml:LinearRing><gml:posList>750560.69 1028819.01 750558.21 1028752.83 750553.39 1028706.70 750543.92 1028655.31 750531.09 1028585.67 750408.21 1028583.46 750285.33 1028581.25 750276.04 1028581.09 750269.27 1028580.97 750261.08 1028581.24 750259.89 1028576.07 750258.06 1028568.08 750243.68 1028505.40 750240.14 1028488.28 750237.57 1028473.21 750122.25 1028455.94 750006.94 1028438.67 749832.63 1028412.57 749826.54 1028411.66 749798.64 1028386.80 749791.59 1028376.15 749792.39 1028357.60 749797.37 1028325.96 749797.28 1028325.70 749792.69 1028312.86 749758.83 1028329.70 749728.78 1028357.10 749708.90 1028373.36 749699.51 1028383.15 749697.12 1028385.44 749663.99 1028379.26 749624.72 1028376.30 749601.19 1028374.53 749567.46 1028373.92 749502.19 1028361.37 749468.96 1028351.32 749453.22 1028339.28 749451.35 1028337.86 749426.29 1028341.54 749406.84 1028345.78 749385.12 1028356.75 749364.32 1028354.42 749349.42 1028356.93 749342.67 1028338.30 749382.05 1028324.35 749424.27 1028303.30 749448.37 1028298.17 749520.41 1028287.23 749591.24 1028257.24 749609.07 1028243.38 749624.28 1028222.87 749632.07 1028198.22 749626.74 1028179.09 749624.21 1028153.93 749634.08 1028125.76 749667.42 1028077.64 749643.51 1028081.44 749616.68 1028085.60 749577.05 1028091.85 749551.82 1028095.96 749541.32 1028096.80 749527.47 1028096.24 749519.38 1028095.92 749507.26 1028095.43 749468.95 1028094.78 749428.44 1028103.16 749411.34 1028106.64 749408.50 1028107.19 749334.42 1028119.36 749319.85 1028121.36 749298.84 1028123.35 749273.82 1028124.74 749253.09 1028126.98 749231.31 1028128.37 749227.32 1028128.63 749219.85 1028129.00 749203.13 1028129.82 749198.99 1028130.01 749160.14 1028131.84 749148.80 1028132.37 749095.72 1028134.92 749089.58 1028134.93 749082.53 1028134.94 749068.59 1028134.57 749065.15 1028134.55 749052.05 1028134.48 748963.61 1028133.74 748949.24 1028133.46 748900.90 1028130.33 748900.05 1028130.27 748896.93 1028130.10 748893.79 1028171.68 748892.37 1028207.07 748891.07 1028238.17 748886.49 1028306.52 748884.50 1028325.55 748880.34 1028351.71 748875.87 1028390.48 748873.06 1028422.78 748872.03 1028444.89 748871.85 1028492.91 748866.19 1028513.24 748849.22 1028554.79 748851.40 1028556.02 748851.00 1028556.81 748850.14 1028558.49 748848.53 1028561.64 748847.39 1028563.87 748858.59 1028570.39 748879.04 1028585.42 748893.95 1028618.87 748909.31 1028651.41 748929.60 1028681.53 748948.04 1028696.08 748959.74 1028703.92 748986.09 1028746.16 748965.34 1028760.24 749011.82 1028832.17 749034.95 1028875.67 749054.47 1028908.01 749083.60 1028947.71 749126.09 1029000.08 749113.69 1029037.05 749107.37 1029070.21 749106.33 1029095.39 749107.93 1029118.12 749113.37 1029158.47 749120.09 1029187.93 749128.41 1029221.55 749189.55 1029415.33 749189.93 1029417.47 749175.12 1029421.15 749149.71 1029427.45 749136.98 1029430.61 749129.12 1029432.56 749124.06 1029433.82 749119.28 1029435.00 749118.77 1029435.13 749095.46 1029441.51 749080.33 1029445.65 749061.93 1029450.68 749062.13 1029453.27 749062.41 1029456.72 749062.76 1029461.14 749065.76 1029498.68 749069.41 1029544.35 749072.75 1029586.26 749075.70 1029623.18 749078.96 1029664.05 749082.05 1029702.82 749083.65 1029722.81 749046.03 1029728.72 749031.15 1029730.95 749000.20 1029735.59 748996.74 1029736.36 748970.91 1029742.14 748961.08 1029744.34 748922.31 1029753.00 748913.83 1029754.90 748914.18 1029764.31 748914.58 1029775.24 748914.86 1029782.81 748916.71 1029805.97 748917.63 1029817.38 748919.38 1029839.34 748921.44 1029865.03 748928.02 1029931.27 748929.99 1029951.13 748933.03 1029978.63 748934.32 1029990.29 748934.93 1029995.83 748934.99 1029996.62 748940.07 1030058.91 748942.57 1030089.72 748945.67 1030127.74 748946.75 1030142.14 748948.52 1030165.71 748951.31 1030202.49 748951.82 1030209.26 748953.56 1030230.88 748955.21 1030253.42 748955.95 1030266.18 748956.46 1030275.08 748956.63 1030277.95 748957.60 1030293.11 748957.79 1030295.33 748958.85 1030307.93 748959.42 1030314.76 748959.61 1030317.01 748961.59 1030340.57 748963.21 1030359.87 748963.38 1030361.85 748967.14 1030410.54 748967.64 1030416.97 748972.90 1030485.09 748973.44 1030497.56 748975.35 1030542.09 748975.42 1030543.77 748950.34 1030548.89 748947.29 1030549.51 748916.43 1030554.54 748901.73 1030557.23 748875.67 1030562.01 748837.97 1030567.32 748838.10 1030567.80 748839.02 1030570.91 748839.33 1030571.94 748840.52 1030576.48 748841.60 1030580.36 748841.64 1030580.51 748842.49 1030585.27 748848.15 1030678.14 748853.17 1030760.00 748857.88 1030840.73 748858.47 1030847.87 748858.96 1030855.14 748836.40 1030856.56 748810.03 1030858.22 748792.10 1030859.35 748777.71 1030860.34 748756.61 1030861.82 748735.09 1030863.38 748693.08 1030866.53 748673.03 1030867.78 748674.81 1030893.38 748675.46 1030902.81 748676.33 1030912.93 748677.91 1030931.40 748678.13 1030933.92 748680.22 1030950.30 748681.11 1030957.32 748682.43 1030969.20 748684.09 1030984.07 748684.30 1030987.55 748685.49 1031007.05 748686.92 1031030.59 748690.90 1031143.80 748691.07 1031160.63 748689.70 1031167.83 748707.39 1031182.03 748722.92 1031195.78 748729.79 1031203.60 748751.64 1031232.07 748760.60 1031246.17 748781.25 1031283.76 748798.26 1031323.53 748806.56 1031338.74 748839.70 1031384.87 748849.60 1031399.52 748871.82 1031435.81 748890.99 1031459.80 748906.47 1031474.26 748921.69 1031487.98 748950.42 1031517.87 748965.42 1031534.60 748979.15 1031555.13 749011.55 1031609.71 749032.09 1031641.19 749048.73 1031665.88 749071.10 1031702.04 749108.46 1031762.02 749129.39 1031798.03 749152.88 1031836.34 749175.08 1031868.28 749200.15 1031902.80 749213.41 1031921.59 749234.07 1031953.12 749262.36 1031986.05 749279.49 1032001.60 749296.40 1032013.96 749302.08 1032009.41 749318.83 1031996.00 749343.24 1031973.00 749366.73 1031952.22 749391.97 1031930.17 749420.70 1031906.60 749474.60 1031869.87 749471.19 1031864.04 749573.91 1031797.34 749572.26 1031794.84 749598.69 1031778.98 749638.07 1031753.42 749684.23 1031725.83 749728.34 1031697.07 749739.77 1031688.84 749754.15 1031678.65 749770.97 1031666.36 749790.66 1031651.23 749816.17 1031631.64 749838.58 1031613.55 749860.87 1031598.94 749876.03 1031589.13 749887.76 1031581.55 749913.66 1031563.78 749938.42 1031543.63 749954.48 1031531.29 749979.70 1031517.03 749996.94 1031511.00 750031.36 1031498.26 750052.90 1031489.86 750083.62 1031479.15 750108.25 1031467.85 750143.44 1031454.51 750170.82 1031447.20 750191.84 1031442.84 750212.95 1031438.19 750233.53 1031434.92 750246.10 1031433.28 750260.69 1031431.38 750296.31 1031424.71 750300.69 1031423.88 750301.03 1031423.82 750305.72 1031422.79 750306.76 1031422.56 750307.69 1031422.39 750357.05 1031415.57 750426.23 1031403.24 750437.07 1031400.54 750437.48 1031400.44 750440.62 1031399.07 750441.10 1031398.86 750446.24 1031398.36 750452.07 1031397.80 750491.26 1031264.97 750520.49 1031165.91 750646.32 1031149.72 750647.67 1031149.55 750656.68 1031148.39 750658.66 1031148.39 750745.27 1031138.26 750775.56 1031133.83 750807.42 1031129.06 750838.26 1031124.56 750898.39 1031115.53 750960.63 1031106.10 750992.88 1031101.04 751032.04 1031095.46 751051.61 1031092.45 751082.91 1031087.87 751096.64 1031085.80 751116.85 1031081.98 751131.95 1031079.84 751306.94 1031055.01 751379.26 1031044.75 751461.87 1031033.03 751532.14 1031023.06 751669.13 1031003.62 751720.84 1030980.13 751801.69 1030943.41 751804.48 1030942.14 751815.53 1030937.22 751821.22 1030934.68 751819.38 1030928.18 751801.56 1030864.85 751790.55 1030825.74 751768.45 1030765.81 751767.02 1030762.47 751759.73 1030738.03 751748.06 1030686.51 751742.29 1030658.45 751736.32 1030622.66 751727.79 1030574.15 751715.83 1030513.46 751709.58 1030481.20 751705.12 1030447.81 751661.87 1030450.62 751627.42 1030453.34 751611.37 1030455.39 751567.14 1030461.06 751547.84 1030462.96 751517.06 1030464.28 751484.37 1030467.73 751473.05 1030468.68 751450.66 1030469.18 751442.64 1030393.98 751496.55 1030385.63 751595.83 1030371.55 751580.90 1030275.54 751572.10 1030193.29 751570.28 1030176.27 751567.87 1030159.07 751564.81 1030137.31 751563.43 1030127.53 751562.63 1030121.45 751558.27 1030088.11 751557.81 1030084.05 751553.48 1030045.31 751553.07 1030042.51 751549.75 1030020.00 751579.46 1030016.87 751575.23 1029926.56 751577.11 1029840.37 751577.00 1029757.67 751605.22 1029762.32 751645.12 1029770.24 751667.68 1029774.34 751687.92 1029774.26 751691.91 1029790.51 751701.72 1029789.03 751745.04 1029782.49 751782.45 1029775.24 751818.20 1029769.27 751877.98 1029766.57 751879.67 1029744.24 751866.51 1029686.61 751864.77 1029672.89 751867.65 1029655.02 751876.55 1029644.09 751933.79 1029615.50 751949.73 1029605.82 751960.01 1029599.83 751987.19 1029578.43 752009.32 1029561.85 752030.66 1029551.79 752062.07 1029528.51 752064.34 1029527.13 752090.89 1029508.10 752101.61 1029497.51 752106.76 1029492.22 752112.68 1029482.96 752118.49 1029472.18 752081.35 1029465.17 752077.74 1029437.96 752073.32 1029423.23 752069.75 1029408.73 752063.85 1029381.61 752062.94 1029378.15 752061.84 1029374.02 752060.39 1029368.92 751997.44 1029391.48 751911.37 1029420.62 751856.24 1029439.29 751832.21 1029280.14 751815.56 1029169.83 751798.91 1029059.52 751775.67 1029054.81 751747.77 1029051.64 751737.86 1029051.34 751662.37 1029049.03 751662.43 1029047.11 751662.49 1029045.09 751663.17 1029043.04 751664.56 1029038.87 751610.49 1029040.99 751566.44 1029044.55 751539.67 1029046.45 751430.92 1029056.87 751430.92 1029049.87 751427.79 1029050.37 751427.17 1029031.75 751422.62 1028974.79 751418.71 1028933.20 751423.62 1028848.73 751422.81 1028786.81 751422.19 1028777.85 751412.07 1028778.50 751410.68 1028782.72 751406.78 1028784.83 751384.19 1028787.47 751361.66 1028790.10 751341.45 1028788.67 751327.82 1028785.00 751308.65 1028781.16 751305.72 1028781.00 751292.23 1028780.27 751287.62 1028780.80 751251.96 1028784.91 751190.79 1028792.09 751116.20 1028801.72 751111.53 1028802.56 751066.02 1028810.73 751060.77 1028811.74 751030.34 1028817.61 750997.71 1028818.13 750983.78 1028816.23 750976.50 1028815.20 750972.88 1028815.50 750967.40 1028815.95 750964.19 1028816.21 750959.67 1028816.57 750952.64 1028817.15 750860.05 1028821.89 750821.34 1028823.83 750803.30 1028825.42 750782.44 1028828.36 750761.95 1028833.46 750752.86 1028836.76 750748.29 1028838.42 750741.97 1028840.71 750723.14 1028849.84 750716.40 1028853.56 750702.95 1028860.32 750689.09 1028866.00 750674.83 1028870.61 750673.22 1028871.00 750660.20 1028874.14 750585.04 1028889.26 750572.34 1028891.39 750563.76 1028892.25 750560.69 1028819.01</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon></gml:surfaceMember></gml:MultiSurface>'
          }
        )

        pass